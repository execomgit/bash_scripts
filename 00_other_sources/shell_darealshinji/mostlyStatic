#!/bin/bash

# source: http://stackoverflow.com/a/13736155


if [ $# -eq 0 ]; then
    echo -e "Usage: $0 [--exclude <lib_name>]. . . <link_command>"
fi

exclude=()
lib_path=()

while [ $# -ne 0 ]; do
    case "$1" in
        -L*)
            if [ "$1" == -L ]; then
                shift
                LPATH="-L$1"
            else
                LPATH="$1"
            fi

            lib_path+=("$LPATH")
            echo -e -n "\"$LPATH\" "
            ;;

        -l*)
            NAME="$(echo -e $1 | sed 's/-l\(.*\)/\1/')"

            if echo -e "${exclude[@]}" | grep " $NAME " >/dev/null; then
                echo -e -n "$1 "
            else
                LIB="$(gcc $lib_path -print-file-name=lib"$NAME".a)"
                if [ "$LIB" == lib"$NAME".a ]; then
                    echo -e -n "$1 "
                else
                    echo -e -n "\"$LIB\" "
                fi
            fi
            ;;

        --exclude)
            shift
            exclude+=(" $1 ")
            ;;

        *) echo -e -n "$1 "
    esac

    shift
done

echo -e

