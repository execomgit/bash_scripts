#!/bin/bash

echo -e zfs create -o xattr=sa -b $(getconf PAGESIZE) -o compression=lz4 $*
zfs create -o xattr=sa -o compression=lz4 $*

# cat /etc/modprobe.d/zfs.conf
# options zfs l2arc_nocompress=1 zfs_arc_max=8589934592 zfs_arc_meta_limit=6442450944

# ARC monitoring
# cat /proc/spl/kstat/zfs/arcstats

# echo -e for Virtual machines
# echo -e Virtual machine images on ZFS should be stored using either zvols or raw files to avoid unnecessary overhead.
# echo -e If raw files are used, a separate dataset should be used to make it easy to configure recordsize independently. 
# echo -e set volblocksize=4KB
# echo -e set recordsize=4KB
# QEMU / KVM / Xen: AIO should be used to maximize IOPS when using files for guest storage.
zfs create -o xattr=sa -o compression=lz4 -o recordsize=4k -o sync=disabled $*

# echo -e for Bit Torrent
# echo -e set recordsize=16KB
zfs create -o xattr=sa -o compression=off -o recordsize=16KB $*

# echo -e for Web Server
# echo -e atime=off

# echo -e for SSD disk
# echo -e set metaslab_lba_weighting_enabled=0
# echo -e zdb -mmm $POOLNAME #for checking

# echo -e for SSD cache
# echo -e To ensure maximum ZIL performance on NAND flash SSD-based SLOG devices
# echo -e overprovison spare area to increase IOPS
# echo -e ZFS will not benefit from more SLOG storage than the maximum ARC size. That is half of system memory on Linux and 3/4 of system memory on illumos.
# echo -e 1. Run a secure erase on the NAND-flash SSD.
# echo -e 2. Create a partition table on the NAND-flash SSD.
# echo -e 3. Create a 4GB partition.
# echo -e 4. Give the partition to ZFS to use as a log device.

# echo -e for Database
# echo -e for InnoDB data set recordsize=16K
# echo -e for InnoDB data set primarycache=metadata
# echo -e for InnoDB data set logbias=throughput #to avoid cache twice
# echo -e for InnoDB log set recordsize=128K
# echo -e for InnoDB log set primarycache=metadata
# echo -e for InnoDB Set skip-innodb_doublewrite in my.cnf
# echo -e for MyISAM set recordsize=8K
# echo -e for PostgreSQL data set recordsize=8K
# echo -e for PostgreSQL data set logbias=throughput
# echo -e for PostgreSQL WAL set recordsize=8K

